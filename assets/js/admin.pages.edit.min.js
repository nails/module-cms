var NAILS_Admin_CMS_Pages_CreateEdit;NAILS_Admin_CMS_Pages_CreateEdit=function(e,t){var i=this;return i.editor=e,i.templates=t,i.activeTemplate="",i.__construct=function(){i.log("Constructing Pages Editor"),i.bindEvents(),i.populateEditor(),i.editor.addAction("Preview","default",function(){i.showPreview()}),i.editor.addAction("Publish Changes","success",function(){i.submitForm("PUBLISH")}),i.editor.addAction("Save Changes","primary",function(){i.submitForm("SAVE")});var e=$("#page-preview");$("body").append(e),e.css("zIndex",i.editor.container.css("zIndex")),$(".template.selected input").click()},i.bindEvents=function(){return $(".template input").on("click",function(){i.selectTemplate($(this).data("slug"))}),$("button.launch-editor").on("click",function(){if(!i.editor.isReady())return i.log("widget Editor not ready"),!1;var e=$(this).data("area");return i.log('Launching editor for area "'+e+'"'),i.editor.show(e),!1}),$(i.editor).on("widgeteditor-ready",function(){$("button.launch-editor").removeClass("disabled")}),$("#action-preview").on("click",function(){return i.showPreview(),!1}),$("#action-save").on("click",function(){return i.submitForm("SAVE"),!1}),$("#action-publish").on("click",function(){return i.submitForm("PUBLISH"),!1}),$("#page-preview .action-close").on("click",function(){return i.hidePreview(),!1}),$("#page-preview .action-publish").on("click",function(){return i.hidePreview(),i.submitForm("PUBLISH"),!1}),$("#page-preview .action-save").on("click",function(){return i.hidePreview(),i.submitForm("SAVE"),!1}),i},i.populateEditor=function(){var e,t,a;if(e=$("#template-data").val()||null,e=JSON.parse(e)){i.log("Repopulating widget editor");for(t in e)e.hasOwnProperty(t)&&(a=e[t],i.editor.setAreaData(t,a))}return i},i.selectTemplate=function(e){return i.log('Showing template "'+e+'"'),i.activeTemplate=e,$(".template").removeClass("selected"),$("#template-options-none").hide(),$(".additional-fields").hide(),$("#template-areas-none").hide(),$(".template-area").hide(),$(".template[data-slug="+e+"]").addClass("selected"),$("#additional-fields-"+e).show(),$("#template-area-"+e).show(),0===$(".additional-fields:visible").length&&$("#template-options-none").show(),0===$(".template-area:visible").length&&$("#template-areas-none").show(),i},i.showPreview=function(){i.log("Generating preview"),i.getEditorData(),$("body").addClass("noscroll");var e=$("#page-preview");e.addClass("loading").show();var t=parseFloat(e.css("padding")),a=e.find("> .actions").outerHeight(),o=$(window).height()-2*t-a;return e.find(".iframe, .iframe > div").css("height",o),_nails_api.call({controller:"cms/pages",method:"preview",action:"POST",data:$("#main-form").serialize(),success:function(e){$("#page-preview iframe").attr("src",e.data.url)},error:function(e){var t;try{t=JSON.parse(e.responseText)}catch(a){t={status:500,error:"An unknown error occurred."}}i.warn("Failed to generate a preview.",t),$("<div>").text("Failed to generate preview. "+t.error).dialog({title:"An error occurred",resizable:!1,draggable:!1,modal:!0,dialogClass:"group-cms widgeteditor-alert",buttons:{OK:function(){$(this).dialog("close"),i.hidePreview()}}})}}),i},i.hidePreview=function(){return i.log("Hiding preview"),$("#page-preview").hide().removeClass("loading").find("iframe").removeAttr("src"),$("body").removeClass("noscroll"),i},i.submitForm=function(e){return e=e||"SAVE",i.log("Submitting form: "+e),i.getEditorData(),$("#input-action").val(e),$("#main-form").submit(),i},i.getEditorData=function(e){var t,a={};return e=e||i.activeTemplate,$("#template-area-"+e+" .btn").each(function(){t=$(this).data("area"),a[t]=i.editor.getAreaData(t)}),$("#template-data").val(JSON.stringify(a)),i},i.log=function(e,t){"function"==typeof console.log&&(void 0!==t?console.log("CMS Pages:",e,t):console.log("CMS Pages:",e))},i.warn=function(e,t){"function"==typeof console.warn&&(void 0!==t?console.warn("CMS Pages:",e,t):console.warn("CMS Pages:",e))},i.__construct()};
//# sourceMappingURL=admin.pages.edit.min.js.map
